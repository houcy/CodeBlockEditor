!function(e,o){if("object"==typeof exports&&"object"==typeof module)module.exports=o();else if("function"==typeof define&&define.amd)define([],o);else{var t=o();for(var r in t)("object"==typeof exports?exports:e)[r]=t[r]}}(window,(function(){return function(e){var o={};function t(r){if(o[r])return o[r].exports;var l=o[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,t),l.l=!0,l.exports}return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var l in e)t.d(r,l,function(o){return e[o]}.bind(null,l));return r},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=0)}([function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.BlocklyLoader=void 0;var r=n(t(1)),l=n(t(2));function n(e){return e&&e.__esModule?e:{default:e}}var a={BlocklySourceLoader:r.default,BlocklyUtil:l.default};o.BlocklyLoader=a},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},BlocklySourceLoader=function(e,o){this.toolbox_menu=null,this.config_source=null,this.excution=null,this.variable_types_map=null,this.extra_variable_names=null,this.input=e,this.options=o,this.config_map={}};BlocklySourceLoader.http_get=function(e,o){$&&$.ajax?e&&(console.log("BlocklySourceLoader http request:",e),$.ajax({url:e,type:"GET",datatype:"json",success:function(e){o&&o(e)},error:function(e){console.log("BlocklySourceLoader error:",e)}})):console.log("BlocklySourceLoader depends on jquery ajax,please install it")},BlocklySourceLoader.create=function(e,o,t){BlocklySourceLoader.http_get(e,(function(e){var r=(o=o||{}).lang||"zh_cn";console.log("===result",e);var l=e[r];if(l){var n=new BlocklySourceLoader(l,o);n.load((function(){t&&t(n)}))}}))};var arg_len=10;BlocklySourceLoader.forEachArg=function(e,o,t){if(e&&o)for(var r=0;r<arg_len;r++){var l=e[o+r];if(l)for(var n=0;n<l.length;n++){var a=l[n];t&&t(a)}}},BlocklySourceLoader.fix_format_args=function(e){if(e){for(var o=0;o<arg_len;o++){var t=e["arg"+o];if(t){for(var r=0;r<t.length;r++){var l=t[r];"field_number"==l.type&&(l.value=l.text,l.text=null)}e["args"+o]=t,delete e["arg"+o]}}return e}},BlocklySourceLoader.fix_format=function(e){if(e){if(1==(e=BlocklySourceLoader.fix_format_args(e)).previousStatement&&(e.previousStatement=null),1==e.nextStatement&&(e.nextStatement=null),e.output){var o=e.output;"null"==o.type?e.output=null:e.output=o.type}return e}},BlocklySourceLoader.update_variableTypes=function(e,o){if(e&&o){var t=[];for(var r in o)t.push(r);return BlocklySourceLoader.forEachArg(e,"args",(function(e){e&&"field_variable"==e.type&&(e.variableTypes=t)})),e}},BlocklySourceLoader.getAllVariableTypes=function(e){if(e){for(var o={"":""},t={},r=e.length,l=0;l<r;l++){var n=e[l];BlocklySourceLoader.forEachArg(n,"arg",(function(e){if(e&&"field_variable"==e.type){var r=e.variableTypes,l=e.injectVariableTypeValues;if(r)for(var n=0;n<r.length;n++){var a=r[n];o[a]=a}if(l)for(var c in l){o[a]=a;var i=l[c],u=i.length;if(u>0){t[a]||(t[a]={});for(n=0;n<u;n++){var s=i[n];t[a][s]=s}}}}}))}return[o,t]}},BlocklySourceLoader.loadExecution=function(execution_str){execution_str&&eval(execution_str)},BlocklySourceLoader.prototype.registerBlocklyExtensions=function(e){this.setBlocklyColours(e)},BlocklySourceLoader.prototype.setBlocklyColours=function(e){if(e)if(Blockly&&Blockly.Colours){if("string"==typeof e)e=(new DOMParser).parseFromString(e,"application/xml");var o=document.evaluate("//category",e);try{for(var t=o.iterateNext();t;){var r=t.getAttribute("id"),l=t.getAttribute("colour"),n=t.getAttribute("secondaryColour")||l,a=t.getAttribute("tertiaryColour")||l;if(r){Blockly.Colours[r]={primary:l,secondary:n,tertiary:a};var c="colours_"+r;Blockly.Extensions.ALL_[c]||Blockly.Extensions.register(c,Blockly.ScratchBlocks.VerticalExtensions.colourHelper(r))}t=o.iterateNext()}}catch(e){console.log("read toolbox menu error",e)}}else console.warn("Blockly or Blockly.Colours is null")},BlocklySourceLoader.prototype.loadResource=function(e,o,t){o&&"string"==typeof o&&(o=JSON.parse(o)),this.toolbox_menu=e,this.config_json=o,this.excution=t,this.registerBlocklyExtensions(e);var r=BlocklySourceLoader.getAllVariableTypes(o),l=r[0],n=r[1];this.variable_types_map=l,this.extra_variable_names=n,this.parse(o,l),BlocklySourceLoader.loadExecution(t)},BlocklySourceLoader.prototype.load=function(e){var o,t,r,l=this,n=this.input,a=this.options.asset_root+"/"+n[0],c=this.options.asset_root+"/"+n[1],i=this.options.asset_root+"/"+n[2];console.log("s_0",a),console.log("s_1",c),console.log("s_2",i),BlocklySourceLoader.http_get(a,(function(n){console.log("s_0 done",a),console.log("result type",void 0===n?"undefined":_typeof(n)),o=n,BlocklySourceLoader.http_get(c,(function(n){console.log("s_1 done",c),t=n,BlocklySourceLoader.http_get(i,(function(n){console.log("s_2 done",i),r=n,l.loadResource(o,t,r),e&&e()}))}))}))},BlocklySourceLoader.prototype.clearBlocks=function(e){if(e)for(var o=e.length,t=0;t<o;t++){var r=e[t].type;Blockly.Blocks[r]=null,this.config_map[r]=null}},BlocklySourceLoader.prototype.parse=function(e,o){if(e){var t=this;t.clearBlocks(e);for(var r=e.length,l=0;l<r;l++){var n=e[l],a=n.type,c=Blockly.Blocks[a];c||(n=BlocklySourceLoader.fix_format(n),"setLocalVariable"!=a&&"getLocalVariable"!=a||(n=BlocklySourceLoader.update_variableTypes(n,o)),t.config_map[a]=n,c={init:function(){var e=t.config_map[this.type];this.jsonInit(e)}},Blockly.Blocks[a]=c)}}},BlocklySourceLoader.prototype.getConfigMap=function(){return this.config_map},exports.default=BlocklySourceLoader},function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=function(){};r.getNextVariableName=function(e,o){o=o||"";for(var t=e.getVariablesOfType(o),l=0;l<100;l++){var n="object"+l;if(!(a=r.findVariableByName(t,n)))return n}t.sort(Blockly.VariableModel.compareByName);var a=t[t.length-1],c=this.getNameIndex(a.name)||0;return"object"+(c+=1)},r.findVariableByName=function(e,o){for(var t=0;t<e.length;t++){var r=e[t];if(r.name==o)return r}},r.getNameIndex=function(e){if(e){var o=e.match(/object(.+)/);if(o[1])return Number(o[1])}return null},o.default=r}])}));